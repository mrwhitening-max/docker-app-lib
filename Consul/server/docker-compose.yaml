version: '3.8'

services:
  consul-server:
    image: hashicorp/consul:latest
    container_name: consul-server
    hostname: consul-server
    restart: unless-stopped
    network_mode: host  # â† KRITISCH: Nutzt LXC-Netzwerk direkt!
    volumes:
      - consul-data:/consul/data
      - consul-config:/consul/config
    command: >
      agent
      -server
      -ui
      -bootstrap-expect=1
      -client=0.0.0.0
      -bind=${CONSUL_BIND_IP}
      -advertise=${CONSUL_BIND_IP}
      -datacenter=${CONSUL_DATACENTER:-homelab}
    environment:
      - CONSUL_LOCAL_CONFIG={"server":true,"log_level":"${CONSUL_LOG_LEVEL:-INFO}"}

volumes:
  consul-data:
  consul-config: