version: '3.8'

services:
  consul-server:
    image: hashicorp/consul:${CONSUL_VERSION:-latest}
    container_name: consul-server
    hostname: consul-server
    restart: unless-stopped
    ports:
      - "8300:8300"
      - "8301:8301"
      - "8301:8301/udp"
      - "8500:8500"
      - "8600:8600"
      - "8600:8600/udp"
    volumes:
      - /data/consul-data:/consul/data
      - /data/consul-config:/consul/config
    command: >
      agent
      -server
      -ui
      -bootstrap-expect=1
      -client=0.0.0.0
      -bind=${CONSUL_BIND_IP}
      -advertise=${CONSUL_BIND_IP}
      -datacenter=${CONSUL_DATACENTER:-homelab}
    environment:
      - CONSUL_LOCAL_CONFIG={"server":true,"log_level":"${CONSUL_LOG_LEVEL:-INFO}"}

volumes:
  consul-data:
  consul-config: